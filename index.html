<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Novi God Olympics</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&family=Secular+One&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --red-team: #e63946;
            --red-team-dark: #b82d38;
            --green-team: #40916c;
            --green-team-dark: #2d6a4f;
            --gold: #ffd700;
            --gold-dark: #b8860b;
            --bg-dark: #0a1628;
            --bg-light: #1a2a4a;
            --text-light: #ffffff;
            --text-muted: #a0aec0;
        }

        body {
            font-family: 'Rubik', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-light) 100%);
            min-height: 100vh;
            color: var(--text-light);
            overflow-x: hidden;
        }

        h1, h2, h3, .title {
            font-family: 'Secular One', sans-serif;
        }

        /* Snowflakes */
        .snowflakes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }

        .snowflake {
            position: absolute;
            top: -20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            animation: fall linear infinite;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }

        @keyframes fall {
            0% {
                transform: translateY(-20px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0.3;
            }
        }

        /* Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
            display: none;
        }

        .confetti-container.active {
            display: block;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confetti-fall linear infinite;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-20px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Mode Selection */
        .mode-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
        }

        .mode-selection h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .mode-selection .subtitle {
            font-size: 1.5rem;
            margin-bottom: 40px;
            color: var(--text-muted);
        }

        .mode-buttons {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .mode-btn {
            background: linear-gradient(145deg, var(--bg-light), var(--bg-dark));
            border: 3px solid var(--gold);
            border-radius: 20px;
            padding: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .mode-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }

        .mode-btn .icon {
            font-size: 4rem;
            display: block;
            margin-bottom: 15px;
        }

        .mode-btn .label {
            font-family: 'Secular One', sans-serif;
            font-size: 1.5rem;
            color: var(--text-light);
        }

        /* Connection Screen */
        .connection-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
        }

        .room-code {
            font-family: 'Secular One', sans-serif;
            font-size: 5rem;
            color: var(--gold);
            letter-spacing: 15px;
            margin: 30px 0;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .connection-status {
            font-size: 1.2rem;
            color: var(--text-muted);
            margin-top: 20px;
        }

        .connection-status.connected {
            color: var(--green-team);
        }

        .code-input {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .code-input input {
            width: 60px;
            height: 70px;
            font-size: 2rem;
            text-align: center;
            border: 3px solid var(--gold);
            border-radius: 10px;
            background: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Secular One', sans-serif;
            text-transform: uppercase;
        }

        .connect-btn {
            background: linear-gradient(145deg, var(--gold), var(--gold-dark));
            border: none;
            border-radius: 15px;
            padding: 15px 40px;
            font-size: 1.3rem;
            font-family: 'Secular One', sans-serif;
            color: var(--bg-dark);
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .connect-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
        }

        /* TV Display */
        .tv-display {
            display: none;
            min-height: 100vh;
            padding: 20px;
        }

        .tv-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 60px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .tv-team-score {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .tv-team-score.team1 {
            flex-direction: row-reverse;
        }

        .tv-team-name {
            font-family: 'Secular One', sans-serif;
            font-size: 2rem;
        }

        .team1 .tv-team-name {
            color: var(--red-team);
        }

        .team2 .tv-team-name {
            color: var(--green-team);
        }

        .tv-score {
            font-family: 'Secular One', sans-serif;
            font-size: 4rem;
            width: 100px;
            text-align: center;
        }

        .team1 .tv-score {
            color: var(--red-team);
            text-shadow: 0 0 20px rgba(230, 57, 70, 0.5);
        }

        .team2 .tv-score {
            color: var(--green-team);
            text-shadow: 0 0 20px rgba(64, 145, 108, 0.5);
        }

        .tv-vs {
            font-family: 'Secular One', sans-serif;
            font-size: 2rem;
            color: var(--gold);
        }

        .tv-main {
            display: flex;
            gap: 20px;
            height: calc(100vh - 180px);
        }

        .tv-team-panel {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 20px;
            max-width: 300px;
        }

        .tv-team-panel.team1 {
            border: 3px solid var(--red-team);
        }

        .tv-team-panel.team2 {
            border: 3px solid var(--green-team);
        }

        .tv-panel-title {
            font-family: 'Secular One', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .team1 .tv-panel-title {
            color: var(--red-team);
        }

        .team2 .tv-panel-title {
            color: var(--green-team);
        }

        .tv-player-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .tv-player {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem;
        }

        .tv-player.played {
            opacity: 0.5;
        }

        .tv-player.playing {
            animation: pulse 1s infinite;
        }

        .team1 .tv-player.playing {
            background: rgba(230, 57, 70, 0.3);
            border: 2px solid var(--red-team);
        }

        .team2 .tv-player.playing {
            background: rgba(64, 145, 108, 0.3);
            border: 2px solid var(--green-team);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .player-badge {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: var(--gold);
            color: var(--bg-dark);
        }

        .tv-center {
            flex: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 40px;
        }

        .tv-phase-text {
            font-size: 2rem;
            color: var(--text-muted);
            text-align: center;
        }

        .tv-game-icon {
            font-size: 8rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .tv-game-title {
            font-family: 'Secular One', sans-serif;
            font-size: 3rem;
            color: var(--gold);
            text-align: center;
            margin-bottom: 10px;
        }

        .tv-game-desc {
            font-size: 1.3rem;
            color: var(--text-muted);
            text-align: center;
            margin-bottom: 30px;
        }

        .tv-timer {
            font-family: 'Secular One', sans-serif;
            font-size: 5rem;
            color: var(--gold);
            margin: 20px 0;
        }

        .tv-game-scores {
            display: flex;
            gap: 60px;
            margin-top: 30px;
        }

        .tv-game-score {
            text-align: center;
        }

        .tv-game-score-value {
            font-family: 'Secular One', sans-serif;
            font-size: 8rem;
        }

        .team1 .tv-game-score-value {
            color: var(--red-team);
        }

        .team2 .tv-game-score-value {
            color: var(--green-team);
        }

        .tv-game-score-label {
            font-size: 1.2rem;
            color: var(--text-muted);
        }

        /* Winner Display */
        .tv-winner {
            text-align: center;
        }

        .tv-winner-trophy {
            font-size: 10rem;
            animation: trophy-bounce 1s infinite;
        }

        @keyframes trophy-bounce {
            0%, 100% { transform: scale(1) rotate(-5deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        .tv-winner-text {
            font-family: 'Secular One', sans-serif;
            font-size: 4rem;
            margin-top: 20px;
        }

        .tv-winner-text.team1 {
            color: var(--red-team);
        }

        .tv-winner-text.team2 {
            color: var(--green-team);
        }

        .tv-winner-text.tie {
            color: var(--gold);
        }

        /* Final Display */
        .tv-final {
            text-align: center;
        }

        .tv-final-crown {
            font-size: 12rem;
            animation: crown-glow 2s infinite;
        }

        @keyframes crown-glow {
            0%, 100% {
                filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5));
                transform: scale(1);
            }
            50% {
                filter: drop-shadow(0 0 40px rgba(255, 215, 0, 0.8));
                transform: scale(1.05);
            }
        }

        .tv-final-title {
            font-family: 'Secular One', sans-serif;
            font-size: 3rem;
            color: var(--gold);
            margin-bottom: 20px;
        }

        .tv-final-winner {
            font-family: 'Secular One', sans-serif;
            font-size: 5rem;
        }

        .tv-final-winner.team1 {
            color: var(--red-team);
        }

        .tv-final-winner.team2 {
            color: var(--green-team);
        }

        .tv-final-winner.tie {
            color: var(--gold);
        }

        .tv-final-scores {
            display: flex;
            justify-content: center;
            gap: 100px;
            margin-top: 40px;
        }

        .tv-final-score {
            text-align: center;
        }

        .tv-final-score-value {
            font-family: 'Secular One', sans-serif;
            font-size: 6rem;
        }

        .team1 .tv-final-score-value {
            color: var(--red-team);
        }

        .team2 .tv-final-score-value {
            color: var(--green-team);
        }

        /* Remote Control */
        .remote-control {
            display: none;
            min-height: 100vh;
            padding: 10px;
            padding-bottom: 100px;
        }

        .remote-header {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .remote-title {
            font-family: 'Secular One', sans-serif;
            font-size: 1.5rem;
            color: var(--gold);
        }

        .remote-status {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        .remote-status.connected {
            color: var(--green-team);
        }

        .remote-scorebar {
            display: flex;
            justify-content: space-around;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .remote-team-mini {
            text-align: center;
        }

        .remote-team-mini-name {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .remote-team-mini-score {
            font-family: 'Secular One', sans-serif;
            font-size: 2rem;
        }

        .team1 .remote-team-mini-name,
        .team1 .remote-team-mini-score {
            color: var(--red-team);
        }

        .team2 .remote-team-mini-name,
        .team2 .remote-team-mini-score {
            color: var(--green-team);
        }

        .remote-content {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
        }

        /* Registration */
        .registration-teams {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .registration-team {
            border-radius: 15px;
            padding: 15px;
        }

        .registration-team.team1 {
            background: rgba(230, 57, 70, 0.2);
            border: 2px solid var(--red-team);
        }

        .registration-team.team2 {
            background: rgba(64, 145, 108, 0.2);
            border: 2px solid var(--green-team);
        }

        .registration-team-header {
            margin-bottom: 15px;
        }

        .registration-team-name-input {
            width: 100%;
            padding: 10px;
            font-size: 1.2rem;
            font-family: 'Secular One', sans-serif;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            text-align: center;
        }

        .team1 .registration-team-name-input {
            color: var(--red-team);
        }

        .team2 .registration-team-name-input {
            color: var(--green-team);
        }

        .registration-player-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
            min-height: 40px;
        }

        .registration-player {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .registration-player-remove {
            cursor: pointer;
            opacity: 0.7;
            font-size: 1.1rem;
        }

        .registration-add-player {
            display: flex;
            gap: 10px;
        }

        .registration-add-player input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            font-size: 1rem;
        }

        .registration-add-player button {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
        }

        .team1 .registration-add-player button {
            background: var(--red-team);
            color: white;
        }

        .team2 .registration-add-player button {
            background: var(--green-team);
            color: white;
        }

        .start-games-btn {
            width: 100%;
            padding: 20px;
            margin-top: 20px;
            font-size: 1.5rem;
            font-family: 'Secular One', sans-serif;
            background: linear-gradient(145deg, var(--gold), var(--gold-dark));
            border: none;
            border-radius: 15px;
            color: var(--bg-dark);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-games-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
        }

        .start-games-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Game Selection */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .game-card:hover {
            border-color: var(--gold);
            transform: translateY(-3px);
        }

        .game-card.completed {
            opacity: 0.4;
            pointer-events: none;
        }

        .game-card-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .game-card-title {
            font-family: 'Secular One', sans-serif;
            font-size: 1rem;
            color: var(--gold);
        }

        .finish-olympics-btn {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            font-size: 1.2rem;
            font-family: 'Secular One', sans-serif;
            background: linear-gradient(145deg, var(--gold), var(--gold-dark));
            border: none;
            border-radius: 15px;
            color: var(--bg-dark);
            cursor: pointer;
        }

        /* Player Selection */
        .player-selection {
            text-align: center;
        }

        .player-selection-title {
            font-family: 'Secular One', sans-serif;
            font-size: 1.5rem;
            color: var(--gold);
            margin-bottom: 5px;
        }

        .player-selection-game {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .player-selection-teams {
            display: flex;
            gap: 15px;
        }

        .player-selection-team {
            flex: 1;
            border-radius: 15px;
            padding: 15px;
        }

        .player-selection-team.team1 {
            background: rgba(230, 57, 70, 0.2);
            border: 2px solid var(--red-team);
        }

        .player-selection-team.team2 {
            background: rgba(64, 145, 108, 0.2);
            border: 2px solid var(--green-team);
        }

        .player-selection-team-title {
            font-family: 'Secular One', sans-serif;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .team1 .player-selection-team-title {
            color: var(--red-team);
        }

        .team2 .player-selection-team-title {
            color: var(--green-team);
        }

        .player-selection-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .player-selection-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .player-selection-item.played {
            opacity: 0.4;
        }

        .player-selection-item.selected {
            font-weight: bold;
        }

        .team1 .player-selection-item.selected {
            background: var(--red-team);
        }

        .team2 .player-selection-item.selected {
            background: var(--green-team);
        }

        .start-game-btn {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            font-size: 1.3rem;
            font-family: 'Secular One', sans-serif;
            background: linear-gradient(145deg, var(--gold), var(--gold-dark));
            border: none;
            border-radius: 15px;
            color: var(--bg-dark);
            cursor: pointer;
        }

        .start-game-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Playing */
        .playing-view {
            text-align: center;
        }

        .playing-game-name {
            font-family: 'Secular One', sans-serif;
            font-size: 1.5rem;
            color: var(--gold);
            margin-bottom: 20px;
        }

        .playing-timer {
            margin-bottom: 20px;
        }

        .playing-timer-display {
            font-family: 'Secular One', sans-serif;
            font-size: 3rem;
            color: var(--gold);
            margin-bottom: 10px;
        }

        .playing-timer-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .timer-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-light);
        }

        .timer-btn.start {
            background: var(--green-team);
        }

        .timer-btn.stop {
            background: var(--red-team);
        }

        .playing-scores {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .playing-score-card {
            flex: 1;
            border-radius: 15px;
            padding: 20px;
        }

        .playing-score-card.team1 {
            background: rgba(230, 57, 70, 0.2);
            border: 2px solid var(--red-team);
        }

        .playing-score-card.team2 {
            background: rgba(64, 145, 108, 0.2);
            border: 2px solid var(--green-team);
        }

        .playing-score-team {
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .playing-score-value {
            font-family: 'Secular One', sans-serif;
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .team1 .playing-score-value {
            color: var(--red-team);
        }

        .team2 .playing-score-value {
            color: var(--green-team);
        }

        .playing-score-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .score-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .score-btn:active {
            transform: scale(0.95);
        }

        .team1 .score-btn {
            background: var(--red-team);
            color: white;
        }

        .team2 .score-btn {
            background: var(--green-team);
            color: white;
        }

        .finish-game-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.3rem;
            font-family: 'Secular One', sans-serif;
            background: linear-gradient(145deg, var(--gold), var(--gold-dark));
            border: none;
            border-radius: 15px;
            color: var(--bg-dark);
            cursor: pointer;
        }

        /* Winner View */
        .winner-view {
            text-align: center;
            padding: 40px 20px;
        }

        .winner-trophy {
            font-size: 6rem;
            margin-bottom: 20px;
            animation: trophy-bounce 1s infinite;
        }

        .winner-text {
            font-family: 'Secular One', sans-serif;
            font-size: 2rem;
            margin-bottom: 30px;
        }

        .winner-text.team1 {
            color: var(--red-team);
        }

        .winner-text.team2 {
            color: var(--green-team);
        }

        .winner-text.tie {
            color: var(--gold);
        }

        .next-game-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.3rem;
            font-family: 'Secular One', sans-serif;
            background: linear-gradient(145deg, var(--gold), var(--gold-dark));
            border: none;
            border-radius: 15px;
            color: var(--bg-dark);
            cursor: pointer;
        }

        /* Final View */
        .final-view {
            text-align: center;
            padding: 40px 20px;
        }

        .final-crown {
            font-size: 6rem;
            margin-bottom: 20px;
            animation: crown-glow 2s infinite;
        }

        .final-title {
            font-family: 'Secular One', sans-serif;
            font-size: 1.5rem;
            color: var(--gold);
            margin-bottom: 10px;
        }

        .final-winner {
            font-family: 'Secular One', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 30px;
        }

        .final-winner.team1 {
            color: var(--red-team);
        }

        .final-winner.team2 {
            color: var(--green-team);
        }

        .final-winner.tie {
            color: var(--gold);
        }

        .final-scores {
            display: flex;
            justify-content: center;
            gap: 50px;
        }

        .final-score {
            text-align: center;
        }

        .final-score-value {
            font-family: 'Secular One', sans-serif;
            font-size: 4rem;
        }

        .team1 .final-score-value {
            color: var(--red-team);
        }

        .team2 .final-score-value {
            color: var(--green-team);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Snowflakes -->
    <div class="snowflakes" id="snowflakes"></div>

    <!-- Confetti -->
    <div class="confetti-container" id="confetti"></div>

    <!-- Mode Selection -->
    <div class="mode-selection" id="mode-selection">
        <h1>Novi God Olympics</h1>
        <p class="subtitle">Party Game Controller</p>
        <div class="mode-buttons">
            <div class="mode-btn" onclick="selectMode('tv')">
                <span class="icon">TV</span>
                <span class="label">TV Display</span>
            </div>
            <div class="mode-btn" onclick="selectMode('remote')">
                <span class="icon">Remote</span>
                <span class="label">Remote Control</span>
            </div>
        </div>
    </div>

    <!-- TV Connection -->
    <div class="connection-screen" id="tv-connection">
        <h2>TV Mode</h2>
        <p>Your Room Code:</p>
        <div class="room-code" id="room-code">----</div>
        <p class="connection-status" id="tv-status">Waiting for connection...</p>
    </div>

    <!-- Remote Connection -->
    <div class="connection-screen" id="remote-connection">
        <h2>Remote Control</h2>
        <p>Enter Room Code:</p>
        <div class="code-input">
            <input type="text" maxlength="1" id="code-1" oninput="handleCodeInput(this, 1)">
            <input type="text" maxlength="1" id="code-2" oninput="handleCodeInput(this, 2)">
            <input type="text" maxlength="1" id="code-3" oninput="handleCodeInput(this, 3)">
            <input type="text" maxlength="1" id="code-4" oninput="handleCodeInput(this, 4)">
        </div>
        <button class="connect-btn" onclick="connectToTV()">Connect</button>
        <p class="connection-status" id="remote-status"></p>
    </div>

    <!-- TV Display -->
    <div class="tv-display" id="tv-display">
        <div class="tv-header">
            <div class="tv-team-score team1">
                <span class="tv-team-name" id="tv-team1-name">Red Team</span>
                <span class="tv-score" id="tv-team1-score">0</span>
            </div>
            <span class="tv-vs">VS</span>
            <div class="tv-team-score team2">
                <span class="tv-score" id="tv-team2-score">0</span>
                <span class="tv-team-name" id="tv-team2-name">Green Team</span>
            </div>
        </div>
        <div class="tv-main">
            <div class="tv-team-panel team1">
                <div class="tv-panel-title" id="tv-panel-team1-name">Red Team</div>
                <div class="tv-player-list" id="tv-team1-players"></div>
            </div>
            <div class="tv-center" id="tv-center">
                <div class="tv-phase-text">Adding players...</div>
            </div>
            <div class="tv-team-panel team2">
                <div class="tv-panel-title" id="tv-panel-team2-name">Green Team</div>
                <div class="tv-player-list" id="tv-team2-players"></div>
            </div>
        </div>
    </div>

    <!-- Remote Control -->
    <div class="remote-control" id="remote-control">
        <div class="remote-header">
            <div class="remote-title">Remote Control</div>
            <div class="remote-status" id="remote-connection-status">Connected</div>
        </div>
        <div class="remote-scorebar">
            <div class="remote-team-mini team1">
                <div class="remote-team-mini-name" id="remote-team1-name">Red Team</div>
                <div class="remote-team-mini-score" id="remote-team1-score">0</div>
            </div>
            <div class="remote-team-mini team2">
                <div class="remote-team-mini-name" id="remote-team2-name">Green Team</div>
                <div class="remote-team-mini-score" id="remote-team2-score">0</div>
            </div>
        </div>
        <div class="remote-content" id="remote-content">
            <!-- Content changes based on phase -->
        </div>
    </div>

    <script>
        // Games data - using simple text icons to avoid encoding issues
        const games = [
            { id: 1, icon: '[TP]', title: 'Toilet Paper Race', description: 'Roll toilet paper with object on end', type: 'individual', hasTimer: false },
            { id: 2, icon: '[C]', title: 'Candle in Bottle', description: 'Candle on string tied to waist into bottle', type: 'individual', hasTimer: false },
            { id: 3, icon: '[H]', title: 'Collect with Hooves', description: 'Collect cotton balls with cups on hands', type: 'individual', hasTimer: true },
            { id: 4, icon: '[G]', title: 'Straw Goal', description: 'Blow ball into cup with straw (best of 3)', type: 'individual', hasTimer: false },
            { id: 5, icon: '[X]', title: 'Cup Tic-Tac-Toe', description: 'Flip cups and place on tic-tac-toe board', type: 'individual', hasTimer: false },
            { id: 6, icon: '[MC]', title: 'Musical Chairs', description: 'Musical chairs variant (best of 3)', type: 'individual', hasTimer: false },
            { id: 7, icon: '[?]', title: 'Find the Difference', description: 'Spot 3 changes in opposing team', type: 'team', hasTimer: true },
            { id: 8, icon: '[P]', title: 'Charades', description: 'Team acts for their representative', type: 'team', hasTimer: true }
        ];

        // State
        let state = {
            mode: null,
            phase: 'registration',
            team1: { name: 'Red Team', players: [], score: 0 },
            team2: { name: 'Green Team', players: [], score: 0 },
            playedPlayers: { team1: [], team2: [] },
            completedGames: [],
            currentGame: null,
            currentPlayers: { team1: [], team2: [] },
            gameScores: { team1: 0, team2: 0 },
            timer: { seconds: 0, running: false },
            winner: null
        };

        // PeerJS
        let peer = null;
        let conn = null;
        let roomCode = '';
        let timerInterval = null;

        // Generate room code
        function generateRoomCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 4; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // Select mode
        function selectMode(mode) {
            state.mode = mode;
            document.getElementById('mode-selection').style.display = 'none';

            if (mode === 'tv') {
                document.getElementById('tv-connection').style.display = 'flex';
                initTVMode();
            } else {
                document.getElementById('remote-connection').style.display = 'flex';
            }
        }

        // Init TV Mode
        function initTVMode() {
            roomCode = generateRoomCode();
            document.getElementById('room-code').textContent = roomCode;

            peer = new Peer('noviGod-' + roomCode);

            peer.on('open', (id) => {
                console.log('TV ready with ID:', id);
            });

            peer.on('connection', (connection) => {
                conn = connection;
                document.getElementById('tv-status').textContent = 'Connected!';
                document.getElementById('tv-status').classList.add('connected');

                setTimeout(() => {
                    document.getElementById('tv-connection').style.display = 'none';
                    document.getElementById('tv-display').style.display = 'block';
                    updateTVDisplay();
                }, 1000);

                conn.on('data', (data) => {
                    handleTVMessage(data);
                });

                conn.on('close', () => {
                    document.getElementById('tv-status').textContent = 'Disconnected - refresh page';
                    document.getElementById('tv-status').classList.remove('connected');
                });
            });

            peer.on('error', (err) => {
                console.error('Peer error:', err);
                document.getElementById('tv-status').textContent = 'Error: ' + err.type;
            });
        }

        // Handle code input
        function handleCodeInput(input, index) {
            input.value = input.value.toUpperCase();
            if (input.value && index < 4) {
                document.getElementById('code-' + (index + 1)).focus();
            }
        }

        // Connect to TV
        function connectToTV() {
            const code =
                document.getElementById('code-1').value +
                document.getElementById('code-2').value +
                document.getElementById('code-3').value +
                document.getElementById('code-4').value;

            if (code.length !== 4) {
                document.getElementById('remote-status').textContent = 'Enter 4-character code';
                return;
            }

            document.getElementById('remote-status').textContent = 'Connecting...';

            peer = new Peer();

            peer.on('open', () => {
                conn = peer.connect('noviGod-' + code);

                conn.on('open', () => {
                    document.getElementById('remote-status').textContent = 'Connected!';
                    document.getElementById('remote-status').classList.add('connected');

                    setTimeout(() => {
                        document.getElementById('remote-connection').style.display = 'none';
                        document.getElementById('remote-control').style.display = 'block';
                        sendMessage({ type: 'request-state' });
                    }, 500);
                });

                conn.on('data', (data) => {
                    handleRemoteMessage(data);
                });

                conn.on('close', () => {
                    document.getElementById('remote-connection-status').textContent = 'Disconnected';
                    document.getElementById('remote-connection-status').classList.remove('connected');
                });
            });

            peer.on('error', (err) => {
                console.error('Peer error:', err);
                document.getElementById('remote-status').textContent = 'Error: ' + err.type;
            });
        }

        // Send message
        function sendMessage(data) {
            if (conn && conn.open) {
                conn.send(data);
            }
        }

        // Handle TV messages
        function handleTVMessage(data) {
            console.log('TV received:', data);

            switch (data.type) {
                case 'request-state':
                    sendStateUpdate();
                    break;
                case 'update-team-name':
                    state[data.team].name = data.name;
                    sendStateUpdate();
                    break;
                case 'add-player':
                    if (state[data.team].players.length < 7) {
                        state[data.team].players.push(data.player);
                        sendStateUpdate();
                    }
                    break;
                case 'remove-player':
                    state[data.team].players.splice(data.index, 1);
                    sendStateUpdate();
                    break;
                case 'start-games':
                    state.phase = 'game-selection';
                    sendStateUpdate();
                    break;
                case 'select-game':
                    state.currentGame = games.find(g => g.id === data.gameId);
                    state.gameScores = { team1: 0, team2: 0 };
                    state.currentPlayers = { team1: [], team2: [] };
                    state.timer = { seconds: 0, running: false };
                    state.phase = 'player-selection';
                    sendStateUpdate();
                    break;
                case 'select-player':
                    const playerList = state.currentPlayers[data.team];
                    const idx = playerList.indexOf(data.player);
                    if (idx > -1) {
                        playerList.splice(idx, 1);
                    } else {
                        if (state.currentGame.type === 'team') {
                            state.currentPlayers[data.team] = state[data.team].players.slice();
                        } else {
                            state.currentPlayers[data.team] = [data.player];
                        }
                    }
                    sendStateUpdate();
                    break;
                case 'start-game':
                    state.phase = 'playing';
                    sendStateUpdate();
                    break;
                case 'update-score':
                    state.gameScores[data.team] = Math.max(0, state.gameScores[data.team] + data.delta);
                    sendStateUpdate();
                    break;
                case 'timer-start':
                    state.timer.running = true;
                    startTimer();
                    sendStateUpdate();
                    break;
                case 'timer-stop':
                    state.timer.running = false;
                    stopTimer();
                    sendStateUpdate();
                    break;
                case 'timer-reset':
                    state.timer.seconds = 0;
                    state.timer.running = false;
                    stopTimer();
                    sendStateUpdate();
                    break;
                case 'finish-game':
                    // Determine winner
                    if (state.gameScores.team1 > state.gameScores.team2) {
                        state.winner = 'team1';
                        state.team1.score++;
                    } else if (state.gameScores.team2 > state.gameScores.team1) {
                        state.winner = 'team2';
                        state.team2.score++;
                    } else {
                        state.winner = 'tie';
                    }
                    // Mark players as played
                    state.currentPlayers.team1.forEach(p => {
                        if (!state.playedPlayers.team1.includes(p)) {
                            state.playedPlayers.team1.push(p);
                        }
                    });
                    state.currentPlayers.team2.forEach(p => {
                        if (!state.playedPlayers.team2.includes(p)) {
                            state.playedPlayers.team2.push(p);
                        }
                    });
                    // Mark game as completed
                    if (!state.completedGames.includes(state.currentGame.id)) {
                        state.completedGames.push(state.currentGame.id);
                    }
                    state.phase = 'winner';
                    stopTimer();
                    sendStateUpdate();
                    break;
                case 'back-to-selection':
                    state.phase = 'game-selection';
                    state.currentGame = null;
                    state.winner = null;
                    sendStateUpdate();
                    break;
                case 'show-final':
                    // Determine overall winner
                    if (state.team1.score > state.team2.score) {
                        state.winner = 'team1';
                    } else if (state.team2.score > state.team1.score) {
                        state.winner = 'team2';
                    } else {
                        state.winner = 'tie';
                    }
                    state.phase = 'final';
                    sendStateUpdate();
                    break;
            }

            updateTVDisplay();
        }

        // Send state update
        function sendStateUpdate() {
            sendMessage({ type: 'state-update', state: state });
        }

        // Handle Remote messages
        function handleRemoteMessage(data) {
            console.log('Remote received:', data);
            if (data.type === 'state-update') {
                state = data.state;
                updateRemoteDisplay();
            }
        }

        // Timer functions
        function startTimer() {
            stopTimer();
            timerInterval = setInterval(() => {
                state.timer.seconds++;
                updateTVDisplay();
                sendStateUpdate();
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
        }

        // Update TV Display
        function updateTVDisplay() {
            // Update header scores
            document.getElementById('tv-team1-name').textContent = state.team1.name;
            document.getElementById('tv-team2-name').textContent = state.team2.name;
            document.getElementById('tv-team1-score').textContent = state.team1.score;
            document.getElementById('tv-team2-score').textContent = state.team2.score;

            // Update panel names
            document.getElementById('tv-panel-team1-name').textContent = state.team1.name;
            document.getElementById('tv-panel-team2-name').textContent = state.team2.name;

            // Update player lists
            updateTVPlayerList('team1');
            updateTVPlayerList('team2');

            // Update center content
            updateTVCenter();
        }

        function updateTVPlayerList(team) {
            const container = document.getElementById('tv-' + team + '-players');
            container.innerHTML = '';

            state[team].players.forEach(function(player) {
                const div = document.createElement('div');
                div.className = 'tv-player';

                const played = state.playedPlayers[team].includes(player);
                const playing = state.currentPlayers[team].includes(player);

                if (played && !playing) div.classList.add('played');
                if (playing) div.classList.add('playing');

                div.innerHTML = '<span>' + player + '</span>' +
                    (played ? '<span class="player-badge">Played</span>' : '');
                container.appendChild(div);
            });
        }

        function updateTVCenter() {
            const center = document.getElementById('tv-center');

            switch (state.phase) {
                case 'registration':
                    center.innerHTML = '<div class="tv-phase-text">Adding players...</div>';
                    break;

                case 'game-selection':
                    center.innerHTML = '<div class="tv-phase-text">Selecting game...</div>';
                    break;

                case 'player-selection':
                    center.innerHTML =
                        '<div class="tv-game-icon">' + state.currentGame.icon + '</div>' +
                        '<div class="tv-game-title">' + state.currentGame.title + '</div>' +
                        '<div class="tv-game-desc">' + state.currentGame.description + '</div>' +
                        '<div class="tv-phase-text">Selecting players...</div>';
                    break;

                case 'playing':
                    var timerHtml = '';
                    if (state.currentGame.hasTimer) {
                        timerHtml = '<div class="tv-timer">' + formatTime(state.timer.seconds) + '</div>';
                    }
                    center.innerHTML =
                        '<div class="tv-game-icon">' + state.currentGame.icon + '</div>' +
                        '<div class="tv-game-title">' + state.currentGame.title + '</div>' +
                        timerHtml +
                        '<div class="tv-game-scores">' +
                            '<div class="tv-game-score team1">' +
                                '<div class="tv-game-score-value">' + state.gameScores.team1 + '</div>' +
                                '<div class="tv-game-score-label">' + state.team1.name + '</div>' +
                            '</div>' +
                            '<div class="tv-game-score team2">' +
                                '<div class="tv-game-score-value">' + state.gameScores.team2 + '</div>' +
                                '<div class="tv-game-score-label">' + state.team2.name + '</div>' +
                            '</div>' +
                        '</div>';
                    break;

                case 'winner':
                    var winnerName = state.winner === 'tie' ? 'Tie!' : state[state.winner].name + ' Wins!';
                    center.innerHTML =
                        '<div class="tv-winner">' +
                            '<div class="tv-winner-trophy">TROPHY</div>' +
                            '<div class="tv-winner-text ' + state.winner + '">' + winnerName + '</div>' +
                        '</div>';
                    break;

                case 'final':
                    var finalWinnerName = state.winner === 'tie' ? 'Tie!' : state[state.winner].name + ' Wins!';
                    center.innerHTML =
                        '<div class="tv-final">' +
                            '<div class="tv-final-crown">CROWN</div>' +
                            '<div class="tv-final-title">Novi God Olympics Champions!</div>' +
                            '<div class="tv-final-winner ' + state.winner + '">' + finalWinnerName + '</div>' +
                            '<div class="tv-final-scores">' +
                                '<div class="tv-final-score team1">' +
                                    '<div class="tv-final-score-value">' + state.team1.score + '</div>' +
                                    '<div>' + state.team1.name + '</div>' +
                                '</div>' +
                                '<div class="tv-final-score team2">' +
                                    '<div class="tv-final-score-value">' + state.team2.score + '</div>' +
                                    '<div>' + state.team2.name + '</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>';
                    // Show confetti
                    document.getElementById('confetti').classList.add('active');
                    createConfetti();
                    break;
            }
        }

        // Update Remote Display
        function updateRemoteDisplay() {
            // Update scorebar
            document.getElementById('remote-team1-name').textContent = state.team1.name;
            document.getElementById('remote-team2-name').textContent = state.team2.name;
            document.getElementById('remote-team1-score').textContent = state.team1.score;
            document.getElementById('remote-team2-score').textContent = state.team2.score;

            // Update content based on phase
            const content = document.getElementById('remote-content');

            switch (state.phase) {
                case 'registration':
                    content.innerHTML = renderRegistration();
                    break;

                case 'game-selection':
                    content.innerHTML = renderGameSelection();
                    break;

                case 'player-selection':
                    content.innerHTML = renderPlayerSelection();
                    break;

                case 'playing':
                    content.innerHTML = renderPlaying();
                    break;

                case 'winner':
                    content.innerHTML = renderWinner();
                    break;

                case 'final':
                    content.innerHTML = renderFinal();
                    document.getElementById('confetti').classList.add('active');
                    createConfetti();
                    break;
            }
        }

        function renderRegistration() {
            const canStart = state.team1.players.length > 0 && state.team2.players.length > 0;

            var team1Players = '';
            state.team1.players.forEach(function(p, i) {
                team1Players += '<div class="registration-player">' + p +
                    '<span class="registration-player-remove" onclick="removePlayer(\'team1\', ' + i + ')">X</span></div>';
            });

            var team2Players = '';
            state.team2.players.forEach(function(p, i) {
                team2Players += '<div class="registration-player">' + p +
                    '<span class="registration-player-remove" onclick="removePlayer(\'team2\', ' + i + ')">X</span></div>';
            });

            return '<div class="registration-teams">' +
                '<div class="registration-team team1">' +
                    '<div class="registration-team-header">' +
                        '<input type="text" class="registration-team-name-input" value="' + state.team1.name + '" ' +
                            'onchange="updateTeamName(\'team1\', this.value)" placeholder="Team name">' +
                    '</div>' +
                    '<div class="registration-player-list">' + team1Players + '</div>' +
                    '<div class="registration-add-player">' +
                        '<input type="text" id="new-player-team1" placeholder="Player name" onkeypress="if(event.key===\'Enter\')addPlayer(\'team1\')">' +
                        '<button onclick="addPlayer(\'team1\')">+</button>' +
                    '</div>' +
                '</div>' +
                '<div class="registration-team team2">' +
                    '<div class="registration-team-header">' +
                        '<input type="text" class="registration-team-name-input" value="' + state.team2.name + '" ' +
                            'onchange="updateTeamName(\'team2\', this.value)" placeholder="Team name">' +
                    '</div>' +
                    '<div class="registration-player-list">' + team2Players + '</div>' +
                    '<div class="registration-add-player">' +
                        '<input type="text" id="new-player-team2" placeholder="Player name" onkeypress="if(event.key===\'Enter\')addPlayer(\'team2\')">' +
                        '<button onclick="addPlayer(\'team2\')">+</button>' +
                    '</div>' +
                '</div>' +
            '</div>' +
            '<button class="start-games-btn" onclick="startGames()" ' + (canStart ? '' : 'disabled') + '>' +
                'Start Games!' +
            '</button>';
        }

        function renderGameSelection() {
            var gameCards = '';
            games.forEach(function(game) {
                var completed = state.completedGames.includes(game.id) ? 'completed' : '';
                gameCards += '<div class="game-card ' + completed + '" onclick="selectGame(' + game.id + ')">' +
                    '<div class="game-card-icon">' + game.icon + '</div>' +
                    '<div class="game-card-title">' + game.title + '</div>' +
                '</div>';
            });

            return '<div class="game-grid">' + gameCards + '</div>' +
                '<button class="finish-olympics-btn" onclick="showFinal()">Finish & Announce Winner</button>';
        }

        function renderPlayerSelection() {
            const game = state.currentGame;
            const isTeamGame = game.type === 'team';

            var team1Players = '';
            state.team1.players.forEach(function(p) {
                var played = state.playedPlayers.team1.includes(p) ? 'played' : '';
                var selected = state.currentPlayers.team1.includes(p) ? 'selected' : '';
                team1Players += '<div class="player-selection-item ' + played + ' ' + selected + '" ' +
                    'onclick="selectPlayer(\'team1\', \'' + p + '\')">' + p + '</div>';
            });

            var team2Players = '';
            state.team2.players.forEach(function(p) {
                var played = state.playedPlayers.team2.includes(p) ? 'played' : '';
                var selected = state.currentPlayers.team2.includes(p) ? 'selected' : '';
                team2Players += '<div class="player-selection-item ' + played + ' ' + selected + '" ' +
                    'onclick="selectPlayer(\'team2\', \'' + p + '\')">' + p + '</div>';
            });

            var canStart = state.currentPlayers.team1.length > 0 && state.currentPlayers.team2.length > 0;

            return '<div class="player-selection">' +
                '<div class="player-selection-game">' + game.icon + '</div>' +
                '<div class="player-selection-title">' + game.title + '</div>' +
                '<p style="color: var(--text-muted); margin-bottom: 20px;">' +
                    (isTeamGame ? 'Team game - all players participate' : 'Select one player from each team') +
                '</p>' +
                '<div class="player-selection-teams">' +
                    '<div class="player-selection-team team1">' +
                        '<div class="player-selection-team-title">' + state.team1.name + '</div>' +
                        '<div class="player-selection-list">' + team1Players + '</div>' +
                    '</div>' +
                    '<div class="player-selection-team team2">' +
                        '<div class="player-selection-team-title">' + state.team2.name + '</div>' +
                        '<div class="player-selection-list">' + team2Players + '</div>' +
                    '</div>' +
                '</div>' +
                '<button class="start-game-btn" onclick="startGame()" ' + (canStart ? '' : 'disabled') + '>Start!</button>' +
            '</div>';
        }

        function renderPlaying() {
            const game = state.currentGame;
            var timerHtml = '';

            if (game.hasTimer) {
                timerHtml = '<div class="playing-timer">' +
                    '<div class="playing-timer-display">' + formatTime(state.timer.seconds) + '</div>' +
                    '<div class="playing-timer-controls">' +
                        (state.timer.running
                            ? '<button class="timer-btn stop" onclick="timerStop()">Stop</button>'
                            : '<button class="timer-btn start" onclick="timerStart()">Start</button>'
                        ) +
                        '<button class="timer-btn" onclick="timerReset()">Reset</button>' +
                    '</div>' +
                '</div>';
            }

            return '<div class="playing-view">' +
                '<div class="playing-game-name">' + game.icon + ' ' + game.title + '</div>' +
                timerHtml +
                '<div class="playing-scores">' +
                    '<div class="playing-score-card team1">' +
                        '<div class="playing-score-team">' + state.team1.name + '</div>' +
                        '<div class="playing-score-value">' + state.gameScores.team1 + '</div>' +
                        '<div class="playing-score-controls">' +
                            '<button class="score-btn" onclick="updateScore(\'team1\', -1)">-</button>' +
                            '<button class="score-btn" onclick="updateScore(\'team1\', 1)">+</button>' +
                        '</div>' +
                    '</div>' +
                    '<div class="playing-score-card team2">' +
                        '<div class="playing-score-team">' + state.team2.name + '</div>' +
                        '<div class="playing-score-value">' + state.gameScores.team2 + '</div>' +
                        '<div class="playing-score-controls">' +
                            '<button class="score-btn" onclick="updateScore(\'team2\', -1)">-</button>' +
                            '<button class="score-btn" onclick="updateScore(\'team2\', 1)">+</button>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
                '<button class="finish-game-btn" onclick="finishGame()">Finish Game</button>' +
            '</div>';
        }

        function renderWinner() {
            var winnerName = state.winner === 'tie' ? 'Tie!' : state[state.winner].name + ' Wins!';
            return '<div class="winner-view">' +
                '<div class="winner-trophy">TROPHY</div>' +
                '<div class="winner-text ' + state.winner + '">' + winnerName + '</div>' +
                '<button class="next-game-btn" onclick="backToSelection()">Next Game</button>' +
            '</div>';
        }

        function renderFinal() {
            var finalWinnerName = state.winner === 'tie' ? 'Tie!' : state[state.winner].name + ' Wins!';
            return '<div class="final-view">' +
                '<div class="final-crown">CROWN</div>' +
                '<div class="final-title">Novi God Olympics Champions!</div>' +
                '<div class="final-winner ' + state.winner + '">' + finalWinnerName + '</div>' +
                '<div class="final-scores">' +
                    '<div class="final-score team1">' +
                        '<div class="final-score-value">' + state.team1.score + '</div>' +
                        '<div>' + state.team1.name + '</div>' +
                    '</div>' +
                    '<div class="final-score team2">' +
                        '<div class="final-score-value">' + state.team2.score + '</div>' +
                        '<div>' + state.team2.name + '</div>' +
                    '</div>' +
                '</div>' +
            '</div>';
        }

        // Action functions
        function updateTeamName(team, name) {
            sendMessage({ type: 'update-team-name', team: team, name: name });
        }

        function addPlayer(team) {
            const input = document.getElementById('new-player-' + team);
            const name = input.value.trim();
            if (name) {
                sendMessage({ type: 'add-player', team: team, player: name });
                input.value = '';
            }
        }

        function removePlayer(team, index) {
            sendMessage({ type: 'remove-player', team: team, index: index });
        }

        function startGames() {
            sendMessage({ type: 'start-games' });
        }

        function selectGame(gameId) {
            if (!state.completedGames.includes(gameId)) {
                sendMessage({ type: 'select-game', gameId: gameId });
            }
        }

        function selectPlayer(team, player) {
            sendMessage({ type: 'select-player', team: team, player: player });
        }

        function startGame() {
            sendMessage({ type: 'start-game' });
        }

        function updateScore(team, delta) {
            sendMessage({ type: 'update-score', team: team, delta: delta });
        }

        function timerStart() {
            sendMessage({ type: 'timer-start' });
        }

        function timerStop() {
            sendMessage({ type: 'timer-stop' });
        }

        function timerReset() {
            sendMessage({ type: 'timer-reset' });
        }

        function finishGame() {
            sendMessage({ type: 'finish-game' });
        }

        function backToSelection() {
            sendMessage({ type: 'back-to-selection' });
        }

        function showFinal() {
            sendMessage({ type: 'show-final' });
        }

        // Create snowflakes
        function createSnowflakes() {
            const container = document.getElementById('snowflakes');
            const snowflakeChars = ['*', '+', '.', 'o', '*'];

            for (var i = 0; i < 50; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.textContent = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.animationDuration = (Math.random() * 10 + 5) + 's';
                snowflake.style.animationDelay = (Math.random() * 10) + 's';
                snowflake.style.fontSize = (Math.random() * 15 + 10) + 'px';
                snowflake.style.opacity = Math.random() * 0.7 + 0.3;
                container.appendChild(snowflake);
            }
        }

        // Create confetti
        function createConfetti() {
            const container = document.getElementById('confetti');
            container.innerHTML = '';
            const colors = ['#e63946', '#40916c', '#ffd700', '#ffffff', '#ff6b6b', '#4ecdc4'];

            for (var i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                confetti.style.animationDelay = (Math.random() * 2) + 's';
                confetti.style.width = (Math.random() * 10 + 5) + 'px';
                confetti.style.height = (Math.random() * 10 + 5) + 'px';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                container.appendChild(confetti);
            }
        }

        // Initialize
        createSnowflakes();
    </script>
</body>
</html>
